<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thành Ngữ Nhí - Trí Nhớ Siêu Phàm</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        @keyframes sway { 0%, 100% { transform: rotate(-2deg); } 50% { transform: rotate(2deg); } }
        @keyframes sun-glow { 0%, 100% { box-shadow: 0 0 40px #facc15; } 50% { box-shadow: 0 0 70px #facc15; } }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-sway { animation: sway 4s ease-in-out infinite; transform-origin: bottom; }
        .animate-sun { animation: sun-glow 4s ease-in-out infinite; }
        
        .card-container { perspective: 1000px; }
        .card-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); 
            transform-style: preserve-3d;
        }
        .card-flipped .card-inner { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 1.25rem; display: flex; align-items: center; justify-content: center;
            border-width: 5px;
        }
        .card-back { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); color: white; }
        .card-front { background: white; transform: rotateY(180deg); }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotateY(180deg); }
            25% { transform: translateX(-5px) rotateY(180deg); }
            75% { transform: translateX(5px) rotateY(180deg); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out infinite; }

        /* Celebration Balloons */
        .celebration-balloon {
            position: absolute; bottom: -150px; border-radius: 50% 50% 50% 50% / 45% 45% 55% 55%;
            animation: rise-and-sway linear infinite; box-shadow: inset -10px -10px 20px rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.1);
        }
        .celebration-balloon::after {
            content: ""; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%);
            border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 12px solid currentColor;
            filter: brightness(0.9);
        }
        @keyframes rise-and-sway {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-130vh) translateX(0) rotate(0deg); opacity: 0; }
        }
        
        body { margin: 0; padding: 0; overflow-x: hidden; }
        .insight-appear { animation: scaleIn 0.3s ease-out forwards; }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-hop { animation: btnHop 2s infinite; }
        @keyframes btnHop { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.3.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-sky-50 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useCallback, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';

        const INITIAL_IDIOMS = [
            { id: '1', part1: 'Nước đến chân', part2: 'mới nhảy', explanation: 'Mang sắc thái phê phán, ám chỉ một người hành động khi tình huống đã trở nên cấp bách, không còn đường lùi, thường dẫn đến kết quả kém hoặc rủi ro cao.' },
            { id: '2', part1: 'Đầu tắt', part2: 'mặt tối', explanation: 'Diễn tả cuộc sống lao động cực nhọc, bị cuốn vào mưu sinh, không có thời gian nghỉ ngơi hay chăm lo cho bản thân.' },
            { id: '3', part1: 'Một nắng', part2: 'hai sương', explanation: 'Biểu trưng cho sự cần cù, nhẫn nại và chịu đựng gian khổ trong lao động. Thường dùng để tôn vinh công sức của người lao động chân tay, nhất là nông dân.' },
            { id: '4', part1: 'Lên voi', part2: 'xuống chó', explanation: 'Chỉ sự biến động mạnh mẽ của số phận hoặc địa vị xã hội. Cuộc đời có thể thay đổi rất nhanh: hôm nay giàu sang, quyền lực; ngày mai nghèo khó, bị khinh thường.' },
            { id: '5', part1: 'Mặt dày', part2: 'mày dạn', explanation: 'Chỉ người không biết xấu hổ, bất chấp dư luận, chê trách để đạt mục đích cá nhân.' },
            { id: '6', part1: 'Ăn không', part2: 'nói có', explanation: 'Chỉ hành vi vu khống, bịa đặt, bóp méo sự thật nhằm làm hại hoặc trục lợi. Phản ánh đạo đức xấu và sự thiếu trung thực.' },
            { id: '7', part1: 'Há miệng', part2: 'chờ sung', explanation: 'Chỉ người lười biếng, không chịu làm mà chỉ mong hưởng thành quả sẵn có. Thể hiện tư duy thụ động và thiếu trách nhiệm.' },
            { id: '8', part1: 'Chân lấm', part2: 'tay bùn', explanation: 'Chỉ người lao động chân tay vất vả, thường dùng để nói về nông dân, người làm việc đồng áng, nặng nhọc.' },
            { id: '9', part1: 'Được voi', part2: 'đòi tiên', explanation: 'Chỉ lòng tham lam, không biết điểm dừng, được cái này lại đòi thêm cái khác cao hơn.' },
            { id: '10', part1: 'Tiền mất', part2: 'tật mang', explanation: 'Chỉ tình huống chịu thiệt hại kép: vừa mất tiền, vừa rước thêm phiền tóái, bệnh tật hoặc hậu quả xấu.' },
            { id: '11', part1: 'Đứng núi này', part2: 'trông núi nọ', explanation: 'Không biết trân trọng cái mình đang có, luôn so sánh và ham cái tốt hơn của người khác.' },
            { id: '12', part1: 'Nói một đằng', part2: 'làm một nẻo', explanation: 'Lời nói không đi đôi với việc làm, thiếu trung thực, không giữ lời. Thể hiện con người thiếu uy tín, không đáng tin cậy.' },
            { id: '13', part1: 'Tai to', part2: 'mặt lớn', explanation: 'Chỉ người có quyền lực, địa vị hoặc mối quan hệ rộng, có tiếng nói trong xã hội. Trong nhiều ngữ cảnh còn mang nghĩa mỉa mai, ám chỉ người hay dựa thế lực để gây ảnh hưởng.' },
            { id: '14', part1: 'Mắt thấy', part2: 'tai nghe', explanation: 'Nhấn mạnh thông tin được kiểm chứng trực tiếp, không phải tin đồn hay nghe nói lại.' },
            { id: '15', part1: 'Vào sinh', part2: 'ra tử', explanation: 'Nhấn mạnh tình cảnh hiểm nghèo, không quản ngại khó khăn, nguy hiểm đến tính mạng. Nhấn mạnh sự dũng cảm, mạo hiểm tính mạng và trải nghiệm thực tế dày dặn.' },
        ];

        const TreeSVG = () => (
            <svg width="120" height="180" viewBox="0 0 120 180" fill="none" className="opacity-80">
                <rect x="50" y="100" width="20" height="80" fill="#78350f" />
                <circle cx="60" cy="70" r="60" fill="#15803d" />
                <circle cx="30" cy="50" r="30" fill="#16a34a" />
                <circle cx="90" cy="50" r="30" fill="#16a34a" />
                <circle cx="60" cy="30" r="40" fill="#22c55e" />
            </svg>
        );

        const StudentSVG = () => (
            <svg width="80" height="120" viewBox="0 0 80 120" fill="none">
                <circle cx="40" cy="30" r="25" fill="#fde68a" />
                <rect x="25" y="55" width="30" height="45" rx="5" fill="#3b82f6" />
                <rect x="20" y="100" width="15" height="20" fill="#000" />
                <rect x="45" y="100" width="15" height="20" fill="#000" />
                <circle cx="32" cy="25" r="3" fill="#000" />
                <circle cx="48" cy="25" r="3" fill="#000" />
                <path d="M35 40C35 40 40 45 45 40" stroke="#000" strokeWidth="2" strokeLinecap="round" />
            </svg>
        );

        const PencilSVG = () => (
            <svg width="40" height="80" viewBox="0 0 40 80" fill="none" className="opacity-30 animate-float">
                <path d="M10 60L10 10L20 0L30 10L30 60L20 75L10 60Z" fill="#fbbf24" stroke="#d97706" strokeWidth="2"/>
                <path d="M10 15L30 15" stroke="#d97706" strokeWidth="1"/>
                <rect x="15" y="65" width="10" height="5" fill="#000" />
            </svg>
        );

        const BookSVG = () => (
            <svg width="60" height="70" viewBox="0 0 60 70" fill="none" className="opacity-30 animate-sway">
                <rect x="5" y="5" width="50" height="60" rx="4" fill="#3b82f6" stroke="#1d4ed8" strokeWidth="2"/>
                <path d="M15 20H45M15 30H45M15 40H35" stroke="white" strokeWidth="2" strokeLinecap="round" />
            </svg>
        );

        const RulerSVG = () => (
            <svg width="30" height="100" viewBox="0 0 30 100" fill="none" className="opacity-30 animate-float" style={{animationDelay: '1.5s'}}>
                <rect x="5" y="5" width="20" height="90" rx="2" fill="#d1d5db" stroke="#9ca3af" strokeWidth="2"/>
                {[...Array(9)].map((_, i) => (
                    <line key={i} x1="15" y1={15 + i * 10} x2="25" y2={15 + i * 10} stroke="#4b5563" strokeWidth="1" />
                ))}
            </svg>
        );

        const VictoryEffects = () => {
            const balloons = useMemo(() => Array.from({ length: 45 }).map((_, i) => ({
                id: i, left: `${Math.random() * 100}%`, size: `${Math.random() * 50 + 40}px`,
                delay: `${Math.random() * 8}s`, duration: `${Math.random() * 4 + 5}s`,
                color: ['#FF5E5E', '#FFD93D', '#6BCB77', '#4D96FF', '#917FB3'][Math.floor(Math.random() * 5)],
            })), []);
            return (
                <div className="fixed inset-0 pointer-events-none z-[45] overflow-hidden">
                    {balloons.map(b => (
                        <div key={b.id} className="celebration-balloon"
                            style={{ left: b.left, width: b.size, height: `calc(${b.size} * 1.2)`, color: b.color, backgroundColor: b.color, animationDelay: b.delay, animationDuration: b.duration }}
                        />
                    ))}
                </div>
            );
        };

        const App = () => {
            const [score, setScore] = useState(0);
            const [pieces, setPieces] = useState([]);
            const [flippedPieceIds, setFlippedPieceIds] = useState([]);
            const [matchedIdiomIds, setMatchedIdiomIds] = useState([]);
            const [shakingPieceIds, setShakingPieceIds] = useState([]);
            const [status, setStatus] = useState('LOADING');
            const [feedback, setFeedback] = useState(null);
            const [insight, setInsight] = useState(null);
            const [activeIdioms, setActiveIdioms] = useState([]);
            const [isChecking, setIsChecking] = useState(false);
            const [isPeeking, setIsPeeking] = useState(false);
            const [peekTimer, setPeekTimer] = useState(10);
            const [canContinue, setCanContinue] = useState(false);

            const startNewRound = useCallback((resetScore = false) => {
                if (resetScore) setScore(0);
                const selected = [...INITIAL_IDIOMS].sort(() => 0.5 - Math.random()).slice(0, 4);
                setActiveIdioms(selected);
                const newPieces = [];
                selected.forEach(idiom => {
                    newPieces.push({ id: `p1-${idiom.id}`, text: idiom.part1, idiomId: idiom.id });
                    newPieces.push({ id: `p2-${idiom.id}`, text: idiom.part2, idiomId: idiom.id });
                });
                setPieces([...newPieces].sort(() => 0.5 - Math.random()));
                setFlippedPieceIds([]);
                setMatchedIdiomIds([]);
                setShakingPieceIds([]);
                setIsChecking(false);
                setInsight(null);
                setCanContinue(false);
                setStatus('PLAYING');
                setIsPeeking(true);
                setPeekTimer(10);
            }, []);

            useEffect(() => {
                let interval;
                if (isPeeking && peekTimer > 0) {
                    interval = setInterval(() => setPeekTimer(prev => prev - 1), 1000);
                } else if (peekTimer === 0) {
                    setIsPeeking(false);
                }
                return () => clearInterval(interval);
            }, [isPeeking, peekTimer]);

            useEffect(() => { startNewRound(); }, [startNewRound]);

            const handlePieceClick = (piece) => {
                if (status !== 'PLAYING' || isChecking || isPeeking || canContinue) return;
                if (flippedPieceIds.includes(piece.id) || matchedIdiomIds.includes(piece.idiomId)) return;
                if (flippedPieceIds.length >= 2) return;

                const newFlipped = [...flippedPieceIds, piece.id];
                setFlippedPieceIds(newFlipped);

                if (newFlipped.length === 2) {
                    setIsChecking(true);
                    const [id1, id2] = newFlipped;
                    const p1 = pieces.find(p => p.id === id1);
                    const p2 = pieces.find(p => p.id === id2);

                    setTimeout(() => {
                        if (p1.idiomId === p2.idiomId) {
                            const newScore = score + 10;
                            setScore(newScore);
                            const newMatched = [...matchedIdiomIds, p1.idiomId];
                            setMatchedIdiomIds(newMatched);
                            setFlippedPieceIds([]);
                            setFeedback({ text: 'Rất giỏi! +10', type: 'success' });
                            setIsChecking(false);

                            const idiomObj = activeIdioms.find(i => i.id === p1.idiomId);
                            if (idiomObj) {
                                setInsight({ explanation: idiomObj.explanation, praise: "Tuyệt vời!" });
                            }

                            if (newMatched.length === 4) {
                                setCanContinue(true);
                            }
                        } else {
                            setShakingPieceIds(newFlipped);
                            setFeedback({ text: 'Thử lại nhé!', type: 'error' });
                            setTimeout(() => {
                                setShakingPieceIds([]);
                                setFlippedPieceIds([]);
                                setIsChecking(false);
                            }, 600);
                        }
                    }, 200);
                }
                setTimeout(() => setFeedback(null), 2000);
            };

            const handleContinue = () => {
                if (score >= 100) {
                    setStatus('WON');
                } else {
                    startNewRound();
                }
            };

            return (
                <div className="relative w-full h-screen overflow-hidden flex flex-col font-sans text-gray-800 bg-sky-50 select-none">
                    {/* Background */}
                    <div className="absolute inset-0 z-0 pointer-events-none">
                        <div className="absolute top-10 right-10 w-24 h-24 bg-yellow-400 rounded-full animate-sun flex items-center justify-center">
                            <div className="w-20 h-20 bg-yellow-300 rounded-full border-4 border-yellow-200" />
                        </div>
                        <div className="absolute bottom-0 w-full h-[15%] bg-green-500 rounded-t-[100%] scale-x-150 transform translate-y-1/4"></div>
                        
                        {/* School Supplies */}
                        <div className="absolute top-20 left-10"><PencilSVG /></div>
                        <div className="absolute top-40 right-20 rotate-12"><BookSVG /></div>
                        <div className="absolute bottom-40 left-1/4 -rotate-12"><RulerSVG /></div>
                        <div className="absolute top-1/2 right-10 -rotate-45"><PencilSVG /></div>

                        <div className="absolute bottom-16 left-8 animate-sway"><TreeSVG /></div>
                        <div className="absolute bottom-12 right-4 animate-sway" style={{ animationDelay: '1s' }}><TreeSVG /></div>
                        <div className="absolute bottom-8 left-[15%] transform scale-x-[-1] opacity-90"><StudentSVG /></div>
                        <div className="absolute bottom-8 right-[15%] opacity-90"><StudentSVG /></div>
                    </div>

                    <div className="relative z-10 flex flex-col items-center justify-start h-full pt-6 px-4 overflow-y-auto">
                        <header className="bg-white/95 backdrop-blur-md rounded-3xl shadow-2xl p-4 w-full max-w-2xl flex justify-between items-center mb-6 border-b-8 border-blue-200">
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-600 p-4 rounded-2xl text-white shadow-lg"><i className="fas fa-graduation-cap text-2xl"></i></div>
                                <div>
                                    <h1 className="text-2xl font-black text-blue-900 leading-none">Thành Ngữ Nhí</h1>
                                    <p className="text-[10px] text-blue-600 font-bold mt-1 uppercase tracking-widest leading-none">Siêu trí nhớ</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="text-right">
                                    <div className="text-[10px] font-black text-gray-400 uppercase">Điểm</div>
                                    <div className="text-4xl font-black text-orange-500 tabular-nums">{score}</div>
                                </div>
                            </div>
                        </header>

                        {isPeeking && (
                            <div className="mb-4 text-center animate-pulse">
                                <span className="bg-yellow-400 text-white px-8 py-2 rounded-full font-black text-xl shadow-xl border-4 border-white">
                                    NHỚ NHANH! CÒN {peekTimer}s
                                </span>
                            </div>
                        )}

                        <main className="w-full max-w-4xl grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            {pieces.map((piece, index) => {
                                const isVisible = isPeeking || flippedPieceIds.includes(piece.id) || matchedIdiomIds.includes(piece.idiomId);
                                const isMatched = matchedIdiomIds.includes(piece.idiomId);
                                return (
                                    <div key={piece.id} onClick={() => handlePieceClick(piece)}
                                        className={`card-container relative h-36 w-full cursor-pointer transition-transform duration-300 hover:scale-105 active:scale-95 ${isVisible ? 'card-flipped' : ''}`}
                                    >
                                        <div className={`card-inner h-full w-full ${shakingPieceIds.includes(piece.id) ? 'animate-shake' : ''}`}>
                                            <div className="card-face card-back border-red-500 shadow-md">
                                                <span className="text-7xl font-black opacity-80 drop-shadow-lg">{index + 1}</span>
                                            </div>
                                            <div className={`card-face card-front px-3 py-1 text-center border-blue-400 shadow-xl ${isMatched ? 'border-green-500 bg-green-50' : 'bg-white'}`}>
                                                <p className={`text-xl md:text-2xl font-black leading-tight ${isMatched ? 'text-green-700' : 'text-blue-900'}`}>{piece.text}</p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </main>

                        <div className="w-full max-w-2xl min-h-[140px] flex flex-col items-center justify-center gap-4">
                            {feedback && !canContinue && (
                                <div className={`px-8 py-3 rounded-full font-black shadow-xl animate-bounce text-white flex items-center gap-2 text-xl ${feedback.type === 'success' ? 'bg-green-500' : 'bg-orange-600'}`}>
                                    <i className={`fas ${feedback.type === 'success' ? 'fa-medal' : 'fa-lightbulb'}`}></i>
                                    {feedback.text}
                                </div>
                            )}

                            {insight && !feedback && !canContinue && !isPeeking && (
                                <div className="bg-white/95 p-6 rounded-[2rem] border-l-[15px] border-yellow-400 shadow-2xl w-full insight-appear">
                                    <p className="text-xl md:text-2xl font-bold text-gray-700 italic mb-2 leading-relaxed">"{insight.explanation}"</p>
                                    <div className="flex items-center justify-end gap-2 text-blue-600 font-black uppercase text-sm">
                                        <span>{insight.praise}</span>
                                        <i className="fas fa-heart text-red-500 animate-pulse"></i>
                                    </div>
                                </div>
                            )}

                            {canContinue && (
                                <div className="flex flex-col items-center gap-4 insight-appear w-full">
                                    <div className="bg-green-100 border-4 border-green-500 p-6 rounded-3xl shadow-xl text-center w-full">
                                        <h3 className="text-2xl font-black text-green-700 mb-2">Tuyệt vời!</h3>
                                        <p className="text-lg font-bold text-gray-700 italic">Bé đã hoàn thành xuất sắc màn chơi này.</p>
                                    </div>
                                    <button 
                                        onClick={handleContinue}
                                        className="btn-hop bg-blue-600 hover:bg-blue-700 text-white font-black py-4 px-12 rounded-full text-3xl shadow-[0_10px_0_#1d4ed8] active:shadow-none active:translate-y-1 transition-all flex items-center gap-3 border-4 border-white"
                                    >
                                        BẤM ĐỂ TIẾP TỤC <i className="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>

                    {status === 'WON' && (
                        <>
                            <VictoryEffects />
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-blue-900/40 backdrop-blur-lg p-4 animate-in fade-in duration-500">
                                <div className="bg-white rounded-[3.5rem] p-12 max-w-md w-full shadow-2xl text-center transform animate-in zoom-in duration-500 border-8 border-yellow-100 relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-400 via-red-400 to-blue-400"></div>
                                    <div className="w-32 h-32 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-8 shadow-xl border-8 border-white animate-bounce">
                                        <i className="fas fa-trophy text-white text-6xl"></i>
                                    </div>
                                    <h2 className="text-4xl font-black text-blue-900 mb-2 uppercase">Vô Địch!</h2>
                                    <p className="text-gray-500 mb-10 font-bold text-lg leading-tight">Bé đã đạt 100 điểm thử thách trí nhớ tuyệt đỉnh!</p>
                                    <button onClick={() => startNewRound(true)} className="w-full bg-blue-600 text-white font-black py-5 rounded-3xl shadow-xl hover:scale-105 active:scale-95 transition-all text-2xl flex items-center justify-center gap-3">
                                        <i className="fas fa-play"></i> CHƠI LẠI
                                    </button>
                                </div>
                            </div>
                        </>
                    )}

                    {status === 'LOADING' && (
                        <div className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-sky-100">
                            <div className="w-20 h-20 border-8 border-blue-500 border-t-transparent rounded-full animate-spin mb-8"></div>
                            <p className="text-blue-700 font-black text-2xl uppercase tracking-widest animate-pulse">Đang chuẩn bị...</p>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
